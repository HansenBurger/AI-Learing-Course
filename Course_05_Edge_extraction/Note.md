# 边缘提取

## 一、边缘提取

边缘概念:

1. 定义: 灰度值在很小的缓冲区域内急剧变化到另一个灰度相差较大的灰度值
2. 特征: 边缘**有正负之分，由暗到亮为正，由亮到暗为负**
3. 算法: sobel、prewitt、laplace、Canny(效果最好，实现麻烦)

### 1.1 定义

边缘检测就是图像的灰度变化的度量、检测和定位

### 1.2 高频\&低频信号

高频分量: 图像强度(亮度/灰度)变化剧烈的地方，即边缘

低频分量: 图像强度(亮度/灰度)变化平缓的地方，即大片色块

特点: **人眼对图像中的高频信号更为敏感**

### 1.3 边缘检测原理和步骤

检测步骤:

1. 滤波: 边缘检测基于一阶二阶导数，导数对噪声敏感，须采用滤波器来改善性能(高斯滤波)
2. 增强: 增强将图像灰度点邻域强度值由显著变化的点凸显出来(计算梯度幅值)
3. 检测: 对边缘点进行取舍(阈值化方法检测)

检测原理:

1. 在边缘部分，像素出现较大变化，此时一阶导数会出现极值
2. **一阶导数为极值，二阶导数为0**，就可以进行边缘检测(图像归一化后连续)

可以使用梯度公式:
$$
\begin{equation}
\nabla f(x_0, y_0) = (\frac{\delta f}{\delta x}, \frac{\delta f}{\delta y})
\end{equation}
$$

导数的通用原理(**图像归一化到0-1即连续可以进行求导**):

![derivative](https://www.openinventor.com/reference-manuals/NewRefMan1030/RefManCpp/chap_edgedetection_image04.png)

> 图像中是用求得的**卷积核**(基于一阶或者二阶导数)进行处理

## 二、图像锐化和平滑

二者都属于图像增强方法(对数据集处理方法)

图像锐化:

1. 图像锐化为了突出图像上的边缘，**边缘增强**
2. 常用的为拉普拉苏变换核函数(放大中心点和周围点的差异)

图像平滑:

1. 图像平滑为了突出图像宽大区域，抑制图像噪声和干扰高频成分
2. sobel(基于一阶导数)，局部平均，对于噪声具有平滑作用(可以找到斜向边缘)
3. Prewitt算子，sobel的特例，不如sobel(全是1，没有加权)

prewitt和sobel的区别:

![prewitt_sobel_differ](https://www.researchgate.net/profile/Sarifuddin-Madenda/publication/311605340/figure/fig2/AS:542615251505152@1506380965005/Kernel-of-a-Prewitt-operator-and-b-Sobel-operators.png)

## 三、Canny算法

Canny 是目前最优秀的边缘检测算法之一，其目标为了找到一个最优边缘

最优边缘定义:

1. 好的检测: 尽可能标出实际边缘
2. 好的定位: 标识出的边缘与实际边缘尽可能接近
3. 最小响应: 边缘只能标记一次

### 3.1 Canny步骤

Canny相当于是一系列图像处理步骤的整合:

1. --非必要-- 图像灰度化(灰度图减少计算量)
2. 图像高斯滤波: 滤除掉图像高频噪声
3. 检测图像中水平、垂直和对角边缘(prewitt, sobel算子)
4. 对梯度幅值进行非极大值抑制: 找到局部最大值，非极大值灰度0
5. 用双阈值算法检测和连接边缘

### 3.2 高斯平滑

高斯滤波根据高斯分布的公式(突出中心点的权重):

$$
\begin{equation}
G(x, y) = \frac{1}{2\pi\sigma^2}e^{-\frac{x^2+y^2}{2\sigma^2}}
\end{equation}
$$

转换求得的卷积核，卷积核的大小选择影响Canny检测器性能(尺寸越大，**敏感度越低**)。卷积核越小，对噪声越敏感；卷积核越大，对于边缘检测越不敏感。

因为 **边缘的灵敏度和噪声的灵敏度同源**，所以一般**5X5**是一个比较不错的trade off(抗噪声干扰和边缘检测)

5x5卷积核示例:
$$
\frac{1}{273} \times
\begin{bmatrix}
   1 & 4 &  7 & 4 & 1\\
   4 & 16 & 26 & 16 & 4\\
   7 & 26 & 41 & 26 & 7\\
   4 & 16 & 26 & 16 & 4\\
   1 & 4 &  7 & 4 & 1
\end{bmatrix}
$$

**需要注意**: 平滑过程中会去除噪声也会降低边缘(二者同源导致)

### 3.3 水平垂直检测

应用sobel算子(水平，竖直)，原理同上

### 3.4 非极大值抑制(NMS)

Non-Maximum Suppression(NMS): **搜索局部最大值，抑制非极大值**

> NMS算法在不同应用中的具体实现不一样，思想一样

使用NMS原因: 为了实现目标边缘只标记一次。在目标检测中，会出现同一位置大量候选框，可能重叠，用NMS找到最佳边界框，消除冗余边界框

参考NMS在目标检测的应用:

![NMS_in_detection](https://miro.medium.com/max/1100/1*6d_D0ySg-kOvfrzIRwHIiA.png)

NMS步骤(寻找局部最大值，将非极大值灰度置0):

1. 将当前像素的梯度强度与沿正负梯度方向的两个像素进行比较
2. 如当前点比梯度方向上两点值大，保留，否则抑制

NMS处理示意图:

![NMS_example](https://miro.medium.com/max/828/1*CWrXNSbe7s4qSFr5vylyvQ.png)

其中橙色角度代表处理像素的梯度方向，找到梯度方向相邻的像素的最大值，对于 $\theta$ 介于图上八个区域内的角，则存在虚拟的像素值 $Tmp_1$，$Tmp_2$，求解虚拟像素值使用插值(最近邻，线性，双线性)。

使用线性插值的计算示例(在数组存储中):

![NMS_calculate](https://pic1.imgdb.cn/item/6341247016f2c2beb16aa974.png)

### 3.5 双阈值检测

双阈值检测原因: 完成非极大值抑制，非边缘点均为0，边缘点值(不固定)，但还是可能包含假边缘

阈值类别:

1. 梯度高于高阈值: 强边缘
2. 低阈值 < 梯度 < 高阈值: 弱边缘
3. 梯度小于低阈值: 抑制

阈值的选择取决于**给定输入图片内容**

弱边缘的产生原因是真实边缘，也可能是噪声和颜色变化产生的，因此需要再次筛选

弱边缘的筛选流程:

1. 真实边缘的弱边缘应该连接到强边缘
2. 查看弱边缘和8个相邻像素，只要有强边缘，就可以保留为真实边缘
